<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„æ‹–æ‹½ç™½æ¿</title>
    <style>
        /* --- åŸºç¡€æ ·å¼ --- */
        body { margin: 0; padding: 0; font-family: sans-serif; display: flex; flex-direction: column; height: 100vh; overflow: hidden; background: #222; color: #fff; }
        
        /* --- é¡¶éƒ¨å·¥å…·æ  --- */
        #toolbar { padding: 10px 20px; background: #333; display: flex; gap: 10px; align-items: center; border-bottom: 1px solid #444; }
        button { padding: 8px 16px; cursor: pointer; background: #007bff; border: none; color: white; border-radius: 4px; font-size: 14px; }
        button:hover { background: #0056b3; }
        button.secondary { background: #555; }
        #share-url { flex-grow: 1; background: #111; border: 1px solid #444; color: #aaa; padding: 5px; margin-left: 10px; display: none; }

        /* --- ä¸»ç”»å¸ƒ (å››è±¡é™) --- */
        #canvas-area { flex-grow: 1; position: relative; display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; width: 100%; height: 100%; }
        
        /* è±¡é™èƒŒæ™¯ */
        .quadrant { position: relative; border: 1px solid rgba(255,255,255,0.1); overflow: hidden; }
        .q-tl { background: linear-gradient(135deg, #2a0a2e 0%, #1a1a1a 100%); }
        .q-tr { background: linear-gradient(225deg, #0a1a2e 0%, #1a1a1a 100%); }
        .q-bl { background: linear-gradient(45deg, #2e2a0a 0%, #1a1a1a 100%); }
        .q-br { background: linear-gradient(-45deg, #0a2e0a 0%, #1a1a1a 100%); }

        /* ç½‘æ ¼çº¿ */
        .grid-lines {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none;
            background-image: linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        /* è½´æ ‡ç­¾ */
        .axis-label { position: absolute; background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 4px; font-size: 12px; color: #ccc; cursor: text; border: 1px dashed transparent; z-index: 10; }
        .axis-label:hover { border-color: #666; background: rgba(0,0,0,0.8); }
        #label-top { top: 10px; left: 50%; transform: translateX(-50%); }
        #label-bottom { bottom: 10px; left: 50%; transform: translateX(-50%); }
        #label-left { top: 50%; left: 10px; transform: translateY(-50%); }
        #label-right { top: 50%; right: 10px; transform: translateY(-50%); }

        /* --- åº•éƒ¨å›¾æ ‡æ±  --- */
        #dock { height: 120px; background: #1a1a1a; border-top: 2px solid #444; padding: 10px; display: flex; gap: 10px; overflow-x: auto; align-items: center; z-index: 100; }
        
        /* --- å¯æ‹–æ‹½å›¾æ ‡ --- */
        .draggable-item {
            width: 80px; height: 80px; background-size: cover; background-position: center; background-color: #444;
            border-radius: 8px; cursor: grab; position: relative; flex-shrink: 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3); transition: transform 0.1s;
        }
        .draggable-item:active { cursor: grabbing; transform: scale(1.05); }
        .draggable-item.placed { position: absolute; transform: translate(-50%, -50%); }
    </style>
</head>
<body>

    <div id="toolbar">
        <button onclick="generateShareLink()">ğŸ”— ç”Ÿæˆåˆ†äº«é“¾æ¥</button>
        <button class="secondary" style="background:#d9534f" onclick="resetCanvas()">ğŸ—‘ï¸ é‡ç½®ç”»å¸ƒ</button>
        <input type="text" id="share-url" readonly placeholder="é“¾æ¥ç”Ÿæˆåè¯·å¤åˆ¶...">
    </div>

    <div id="canvas-area" ondrop="drop(event)" ondragover="allowDrop(event)">
        <div class="quadrant q-tl"><div class="grid-lines"></div></div>
        <div class="quadrant q-tr"><div class="grid-lines"></div></div>
        <div class="quadrant q-bl"><div class="grid-lines"></div></div>
        <div class="quadrant q-br"><div class="grid-lines"></div></div>

        <div id="label-top" class="axis-label" contenteditable="true">é«˜ä»·å€¼</div>
        <div id="label-bottom" class="axis-label" contenteditable="true">ä½ä»·å€¼</div>
        <div id="label-left" class="axis-label" contenteditable="true">æ˜“ä¸Šæ‰‹</div>
        <div id="label-right" class="axis-label" contenteditable="true">é«˜éš¾åº¦</div>
    </div>

    <div id="dock" ondrop="dropBackToDock(event)" ondragover="allowDrop(event)">
        </div>

    <script>
		// ================= é…ç½®åŒº =================
		// è¯·åœ¨è¿™é‡Œåˆ—å‡º icons æ–‡ä»¶å¤¹é‡Œæ‰€æœ‰çš„æ–‡ä»¶å
		// ç¡®ä¿æ–‡ä»¶åå’Œæ–‡ä»¶å¤¹é‡Œçš„å®Œå…¨ä¸€è‡´ï¼ˆåŒºåˆ†å¤§å°å†™ï¼ï¼‰
		const iconList = [
			"çˆ±ä¸½å„¿.png",
			"æŠ•å½±ä½“Î».png",
			"Kå…ˆç”Ÿ.png",
			"æ³¡æ²«.png",
			"å¼ºå‡»æ‰‹.png",
			"é»˜æ±‰.png",
			"è„‰å†²æ˜Ÿ.png",
			"ç”µé­”.png",
			"ç›æ ¼å—.png",
			"çŠ¬é½¿.png",
			"è‰¾ç±³è‰äºš.png",
			"åŠ³æ‹‰.png",
			"åº·æ–¯å¦æ–¯.png",
			"åå†².png",
			"å®‰å¦®å¡”.png",
			"çµåª’.png",
			"é“¶æª.png",
			"å¹½çµå…‹æ˜Ÿ.png",
			"åº“ç€.png",
			"é›·å¨œå¡”.png",
			"ç»´å¥¥æ‹‰.png",
			"ç”µå…‰æ¸¸ä¾ .png",
			"ä¼Šä¸æ¢…å°”.png",
			"äº¨å¾·åˆ©.png",
			"ç‘›ç¾.png",
			"ç™½æ˜Ÿ.png",
			"ç‘›å.png",
			"å™¬è±¡è€….png",
			"ä¿¡æ ‡.png",
			"ç©ºä¸­å›šå¾’.png",
			"å¥¥å…¹æ›¼.png",
			"å¡”æ‹‰æ–¯å…‹.png",
			"å™©å…†.png",
			"å¤ªç©ºå°å§.png",
			"è°¢ä¸ƒ.png",
			"å¤œåˆƒ.png",
			"è¯ºæ‹‰.png",
			"é²éœ²éœ².png",
			"æ ¼è•¾èŒœ.png",
			"å¸Œå°”.png",
			"å”¤æµ·äºº.png",
			"è–‡ä¸å¸•é‡‘.png",
			"æ¦›æœ.png",
			"å¹»çœ¸.png",
			"å¼—æ´›ä¼¦ä¸.png",
			"ä¹Œæ‹‰å°¼å¨….png",
			"çŒ©çº¢çŸ³.png",
			"æ ¼ç³çˆ±å°”.png",
			"è¯ºç“¦å…‹.png",
			"æ¢…æŒæŸœ.png",
			"æ³¢å¹³æ–¯å°å§.png",
			"ç½ªå¾’.png",
			"ç´«ç½—å…°.png",
			"æ—èŠ³.png",
			"é“ƒ.png",
			"ä¼Šå¸Œä¸.png",
			"è¯ºè–‡å°”.png",
			"ç›ä¸½å®‰.png",
			"æ–¯æ–‡é¡¿.png",
			"è‰è´å¡.png",
			"å°æ´›ä¼¦ä½.png",
			"é›ªè‰.png",
			"ç½—æ³½.png",
			"è·é©¬å…ˆç”Ÿ.png",
			"è´æ‹‰æ–¯ç§‘.png",
			"é»‘ç‹®å­.png",
			"è±æ˜‚å†…å°”.png",
			"ç»´ç½—å¦®å¡.png",
			"å¾·æ´›ä¸½ä¸.png",
			"è€ƒå®˜.png",
			"å¡ç§‹è.png",
			"ç°çŒ.png",
			"ä¼Šå¾·.png",
			"çˆ±å¦®ä¸.png",
			"å¡å£¬.png",
			"éº¦å¨….png",
			"è±å¨œ.png",
			"åä¸‰å·.png",
			"æ‹‰å¡å°”.png",
			"ç½—æ£®è²å°”å¾·.png",
			"é¦™æ¥ .png",
			"å¸•æ–¯å¡.png",
			"æ²ƒå‰ç‰¹.png",
			"èµ¤ç‹.png",
			"ä¹”ä¼Š.png",
			"å¤œèº.png",
			"é›·è¯º.png",
			"å¨å»‰.png",
			"æ–¯è’‚å°”.png",
			"åˆå¤œ.png",
			"é‡‘å¡”äº”å·.png",
			"è´¾ç±³æ‹‰.png",
			"ç†æŸ¥å¾·æ›¼.png",
			"ç™½é‡‘.png",
			"å·¡é˜²å‘˜å¥¥é‡Œæ–¯.png",
			"å·¡é˜²å‘˜å¸Œå…°.png",
			"å·¡é˜²å‘˜åŠ æ›¼.png"
			// å¦‚æœæœ‰æ›´å¤šï¼Œç»§ç»­æŒ‰æ ¼å¼æ·»åŠ ï¼Œä¾‹å¦‚: "sword.png",
		];
		// =========================================

        let draggedItem = null;
        let startX, startY;

        // åˆå§‹åŒ–ï¼šåŠ è½½å›¾æ ‡
        function initIcons() {
            const dock = document.getElementById('dock');
            
            // æ£€æŸ¥URLæ˜¯å¦æœ‰åˆ†äº«æ•°æ®ï¼Œå¦‚æœæœ‰ï¼Œå…ˆä¸åŠ è½½é»˜è®¤dockï¼Œç­‰æ¢å¤æ•°æ®æ—¶å¤„ç†
            // ä½†ä¸ºäº†ç®€å•ï¼Œæˆ‘ä»¬å…ˆå…¨éƒ¨åŠ è½½åˆ°dockï¼Œç„¶åæ ¹æ®URLç§»åŠ¨ä½ç½®
            
            iconList.forEach(filename => {
                const div = document.createElement('div');
                div.className = 'draggable-item';
                div.draggable = true;
                // å…³é”®ç‚¹ï¼šè·¯å¾„æŒ‡å‘ icons æ–‡ä»¶å¤¹
                div.style.backgroundImage = `url("./icons/${filename}")`;
                // æŠŠæ–‡ä»¶åå­˜åœ¨ dataset é‡Œï¼Œæ–¹ä¾¿åˆ†äº«æ—¶è®°å½•
                div.dataset.filename = filename; 
                div.id = 'icon-' + filename.replace(/[^a-zA-Z0-9]/g, '-'); // ç”Ÿæˆå”¯ä¸€ID
                
                div.ondragstart = dragStart;
                dock.appendChild(div);
            });
            
            // åŠ è½½åˆ†äº«çŠ¶æ€
            loadStateFromURL();
        }

        // --- æ‹–æ‹½é€»è¾‘ ---
        function allowDrop(ev) { ev.preventDefault(); }
        function dragStart(ev) {
            draggedItem = ev.target;
            const rect = draggedItem.getBoundingClientRect();
            startX = ev.clientX - rect.left;
            startY = ev.clientY - rect.top;
        }
        function drop(ev) {
            ev.preventDefault();
            if (!draggedItem) return;
            const canvas = document.getElementById('canvas-area');
            const rect = canvas.getBoundingClientRect();
            let x = ev.clientX - rect.left - (draggedItem.offsetWidth / 2) + (draggedItem.offsetWidth / 2);
            let y = ev.clientY - rect.top - (draggedItem.offsetHeight / 2) + (draggedItem.offsetHeight / 2); 

            if (!draggedItem.classList.contains('placed')) {
                draggedItem.classList.add('placed');
                canvas.appendChild(draggedItem);
            }
            draggedItem.style.left = x + 'px';
            draggedItem.style.top = y + 'px';
            draggedItem = null;
        }
        function dropBackToDock(ev) {
            ev.preventDefault();
            if (!draggedItem) return;
            const dock = document.getElementById('dock');
            draggedItem.classList.remove('placed');
            draggedItem.style.left = ''; draggedItem.style.top = '';
            draggedItem.style.position = 'relative'; draggedItem.style.transform = 'none';
            dock.appendChild(draggedItem);
            draggedItem = null;
        }

        // --- åˆ†äº«é€»è¾‘ (ä¼˜åŒ–ç‰ˆï¼šåªå­˜ä½ç½®å’Œæ–‡ä»¶å) ---
        function generateShareLink() {
            const state = {
                labels: [
                    document.getElementById('label-top').innerText,
                    document.getElementById('label-bottom').innerText,
                    document.getElementById('label-left').innerText,
                    document.getElementById('label-right').innerText
                ],
                positions: [] // æ ¼å¼: { id: "filename", x: "10px", y: "20px" }
            };

            document.querySelectorAll('.draggable-item.placed').forEach(item => {
                state.positions.push({
                    f: item.dataset.filename, // åªå­˜æ–‡ä»¶å
                    x: item.style.left,
                    y: item.style.top
                });
            });

            const jsonStr = JSON.stringify(state);
            const encoded = btoa(encodeURIComponent(jsonStr)); // ç¼–ç 
            const newUrl = window.location.href.split('#')[0] + "#" + encoded;
            
            const input = document.getElementById('share-url');
            input.style.display = 'block';
            input.value = newUrl;
            input.select();
            document.execCommand('copy');
            alert('é“¾æ¥å·²å¤åˆ¶ï¼(é“¾æ¥éå¸¸çŸ­ï¼Œæ”¾å¿ƒåˆ†äº«)');
        }

        function loadStateFromURL() {
            if (!window.location.hash) return;
            try {
                const hash = window.location.hash.substring(1);
                const jsonStr = decodeURIComponent(atob(hash));
                const state = JSON.parse(jsonStr);

                // 1. æ¢å¤æ ‡ç­¾
                if(state.labels) {
                    document.getElementById('label-top').innerText = state.labels[0];
                    document.getElementById('label-bottom').innerText = state.labels[1];
                    document.getElementById('label-left').innerText = state.labels[2];
                    document.getElementById('label-right').innerText = state.labels[3];
                }

                // 2. æ¢å¤å›¾æ ‡ä½ç½®
                if(state.positions) {
                    const canvas = document.getElementById('canvas-area');
                    state.positions.forEach(pos => {
                        // æ‰¾åˆ°å¯¹åº”çš„ DOM å…ƒç´ ï¼ˆæ ¹æ®æ–‡ä»¶åï¼‰
                        const item = document.querySelector(`.draggable-item[data-filename="${pos.f}"]`);
                        if (item) {
                            item.classList.add('placed');
                            item.style.left = pos.x;
                            item.style.top = pos.y;
                            canvas.appendChild(item); // ç§»åŠ¨åˆ°ç”»å¸ƒä¸­
                        }
                    });
                }
            } catch (e) {
                console.error('åŠ è½½çŠ¶æ€å¤±è´¥', e);
            }
        }

        function resetCanvas() {
            if(confirm('é‡ç½®å°†æ¸…é™¤æ‰€æœ‰å¸ƒå±€ï¼Œç¡®å®šå—ï¼Ÿ')) {
                window.location.href = window.location.href.split('#')[0];
            }
        }

        // å¯åŠ¨
        window.onload = initIcons;
    </script>
</body>
</html>