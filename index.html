<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¼‚è±¡å›å£°è§’è‰²ç™½æ¿</title>
    <style>
        :root {
            /* --- æ—¥é—´æ¨¡å¼ (é»˜è®¤) --- */
            --bg-color: #e0e0e0;
            --grid-color: #d1d1d1;
            --toolbar-bg: #f5f5f5;
            --dock-bg: #eeeeee;
            --item-size: 75px; 
            
            --dark-r: 40; --dark-g: 40; --dark-b: 40;
            --global-opacity: 0.1;
            --grid-size: 40px;

            /* è±¡é™é»˜è®¤è®¾ç½® */
            --tl-size: 35%; --tl-blur: 15%; --tl-fs: 64px;
            --tr-size: 35%; --tr-blur: 15%; --tr-fs: 64px;
            --bl-size: 35%; --bl-blur: 15%; --bl-fs: 64px;
            --br-size: 35%; --br-blur: 15%; --br-fs: 64px;
        }

        /* --- å¤œé—´æ¨¡å¼ (Dark Mode) --- */
        body.dark-mode {
            --bg-color: #1a1a1a;
            --grid-color: #333333;
            --toolbar-bg: #252525;
            --dock-bg: #111111;
            color: #eee;
        }
        
        body.dark-mode .btn { background: #333; color: #ccc; border-color: #555; }
        body.dark-mode .btn:hover { background: #444; color: #fff; }
        /* å·²åˆ é™¤ body.dark-mode .btn.active çš„å˜è“æ•ˆæœ */

        body.dark-mode #settings-panel { background: rgba(30, 30, 30, 0.98); border-color: #444; color: #eee; }
        body.dark-mode .control-title { color: #aaa; }
        body.dark-mode .slider-row { color: #888; }
        body.dark-mode .slider-row input[type=number] { background: #222; color: #eee; border-color: #555; }
        body.dark-mode .input-row input[type=text] { background: #222; color: #eee; border-color: #555; }
        
        body.dark-mode .axis-label { background: #444; border-color: #666; color: #eee; }
        body.dark-mode .item-name { background: rgba(0,0,0,0.6); color: #ccc; }
        
        body.dark-mode .floating-textbox { background: rgba(0,0,0,0.4); border-color: rgba(255,255,255,0.2); }
        body.dark-mode .editable-content { color: #aaccff; }
        body.dark-mode .editable-content:empty:before { color: rgba(170, 204, 255, 0.5); }

        /* --- é€šç”¨æ ·å¼ --- */
        body { margin: 0; padding: 0; font-family: "PingFang SC", "Microsoft YaHei", sans-serif; display: flex; flex-direction: column; height: 100vh; background: var(--bg-color); color: #333; overflow: hidden; }

        #toolbar { height: 50px; padding: 0 20px; background: var(--toolbar-bg); display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #ccc; z-index: 2000; }
        .btn { padding: 6px 14px; cursor: pointer; background: #fff; border: 1px solid #bbb; color: #333; border-radius: 4px; font-size: 13px; display: flex; align-items: center; gap: 5px; user-select: none; transition: background 0.2s; }
        .btn:hover { background: #f0f0f0; }
        /* å·²åˆ é™¤ .btn.active çš„å˜è“æ•ˆæœ */

        #settings-panel {
            position: absolute; top: 60px; left: 20px; width: 340px; max-height: 80vh; overflow-y: auto;
            background: rgba(255, 255, 255, 0.98); border: 1px solid #ccc; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); padding: 15px; z-index: 3000; display: none; backdrop-filter: blur(5px);
        }
        .control-group { margin-bottom: 15px; }
        .control-title { font-size: 12px; font-weight: bold; color: #444; margin-bottom: 8px; display: block; }
        
        .slider-row { display: flex; align-items: center; font-size: 11px; color: #666; gap: 8px; margin-bottom: 6px; }
        .slider-label { width: 30px; flex-shrink: 0; }
        .slider-row input[type=range] { flex-grow: 1; cursor: pointer; }
        .slider-row input[type=number] { width: 45px; padding: 2px; border: 1px solid #ccc; border-radius: 3px; font-size: 11px; text-align: center; }
        
        .input-row { display: flex; gap: 5px; margin-top: 5px; }
        .input-row input[type=text] { flex: 1; padding: 4px; font-size: 11px; border: 1px solid #ddd; border-radius: 3px; }

        #canvas-area { flex-grow: 1; position: relative; background-image: linear-gradient(var(--grid-color) 1px, transparent 1px), linear-gradient(90deg, var(--grid-color) 1px, transparent 1px); background-size: var(--grid-size) var(--grid-size); overflow: hidden; }
        #vignette-container { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; pointer-events: none; z-index: 5; }
        .v-quadrant { width: 100%; height: 100%; }
        .vq-tl { background: radial-gradient(circle at bottom right, transparent var(--tl-size), rgba(var(--dark-r), var(--dark-g), var(--dark-b), var(--global-opacity)) calc(var(--tl-size) + var(--tl-blur))); }
        .vq-tr { background: radial-gradient(circle at bottom left, transparent var(--tr-size), rgba(var(--dark-r), var(--dark-g), var(--dark-b), var(--global-opacity)) calc(var(--tr-size) + var(--tr-blur))); }
        .vq-bl { background: radial-gradient(circle at top right, transparent var(--bl-size), rgba(var(--dark-r), var(--dark-g), var(--dark-b), var(--global-opacity)) calc(var(--bl-size) + var(--bl-blur))); }
        .vq-br { background: radial-gradient(circle at top left, transparent var(--br-size), rgba(var(--dark-r), var(--dark-g), var(--dark-b), var(--global-opacity)) calc(var(--br-size) + var(--br-blur))); }

        /* è±¡é™è¯´æ˜æ–‡å­—ä½ç½® */
        .corner-label { position: absolute; color: var(--bg-color); opacity: 0.9; font-weight: bold; pointer-events: none; z-index: 50; }
        #cl-tl { top: 60px; left: 60px; font-size: var(--tl-fs); }
        #cl-tr { top: 60px; right: 60px; font-size: var(--tr-fs); text-align: right; }
        #cl-bl { bottom: 60px; left: 60px; font-size: var(--bl-fs); }
        #cl-br { bottom: 60px; right: 60px; font-size: var(--br-fs); text-align: right; }

        #axes-layer { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; z-index: 6; display: none; }
        .axis-x { position: absolute; top: 50%; left: 0; width: 100%; height: 2px; background: #003366; transform: translateY(-50%); }
        .axis-y { position: absolute; left: 50%; top: 0; height: 100%; width: 2px; background: #003366; transform: translateX(-50%); }
        .arrow { position: absolute; width: 0; height: 0; border: 6px solid transparent; z-index: 7; }
        .arrow-up { top: -5px; left: 50%; border-bottom: 10px solid #003366; transform: translateX(-50%); }
        .arrow-down { bottom: -5px; left: 50%; border-top: 10px solid #003366; transform: translateX(-50%); }
        .arrow-right { right: -5px; top: 50%; border-left: 10px solid #003366; transform: translateY(-50%); }
        .arrow-left { left: -5px; top: 50%; border-right: 10px solid #003366; transform: translateY(-50%); }

        .axis-label { position: absolute; background: #999; padding: 6px 20px; border-radius: 20px; font-size: 16px; font-weight: bold; color: #fff; z-index: 1001; border: 2px solid #fff; outline: none; white-space: nowrap; }

        .floating-textbox {
            position: absolute; width: fit-content; max-width: 400px; min-width: 100px; padding: 8px 12px;
            background: rgba(255,255,255,0.25); border: 1px dashed rgba(0,0,0,0.3); border-radius: 6px; 
            cursor: move; z-index: 1500; backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center;
        }
        .floating-textbox:hover { background: rgba(255,255,255,0.5); border-color: #007bff; }
        .editable-content {
            width: 100%; min-height: 1.2em; outline: none; color: #003366; font-size: 16px; font-weight: 500; cursor: text;
            white-space: pre-wrap; word-break: break-all; line-height: 1.4; text-align: center;
        }
        .editable-content:empty:before { content: attr(data-placeholder); color: rgba(0, 51, 102, 0.5); font-weight: normal; font-style: italic; }
        .textbox-delete {
            position: absolute; top: -10px; right: -10px; width: 20px; height: 20px;
            background: #ff4d4d; color: #fff; border-radius: 50%; font-size: 12px;
            display: none; align-items: center; justify-content: center; cursor: pointer; border: 2px solid #fff;
        }
        .floating-textbox:hover .textbox-delete { display: flex; }

        .draggable-item { width: var(--item-size); cursor: grab; position: relative; display: flex; flex-direction: column; align-items: center; transition: transform 0.2s; user-select: none; z-index: 100; }
        .draggable-item.placed { position: absolute; transform: translate(-50%, -50%); }
        .draggable-item.zoomed { transform: translate(-50%, -50%) scale(1.66) !important; }
        .draggable-item img { width: var(--item-size); height: var(--item-size); object-fit: contain; pointer-events: none; border-radius: 8px; }
        .item-name { font-size: 11px; color: #444; background: rgba(255,255,255,0.45); padding: 1px 5px; border-radius: 4px; margin-top: 4px; white-space: nowrap; max-width: 85px; overflow: hidden; text-overflow: ellipsis; pointer-events: none; }
        .btn-delete { position: absolute; top: -8px; right: -8px; width: 22px; height: 22px; background: #ff4d4d; color: white; border-radius: 50%; font-size: 12px; display: none; align-items: center; justify-content: center; cursor: pointer; border: 2px solid #fff; font-weight: bold; z-index: 10; }
        .draggable-item.placed:hover .btn-delete { display: flex; }
        #dock-container { background: var(--dock-bg); border-top: 1px solid #ccc; padding: 12px 0; z-index: 2000; }
        #dock-info { padding: 0 25px 8px; font-size: 13px; color: #777; text-align: left; }
        #dock { height: 110px; padding: 0 25px; display: flex; gap: 20px; overflow-x: auto; align-items: flex-start; }
    </style>
</head>
<body>

    <div id="toolbar">
        <button class="btn" id="btn-toggle-settings" onclick="toggleSettings()">âš™ï¸ èƒŒæ™¯è®¾ç½®</button>
        <button class="btn" id="btn-toggle-axes" onclick="toggleAxes()">â• æ˜¾ç¤ºåæ ‡è½´ (å…³)</button>
        <button class="btn" id="btn-dark-mode" onclick="toggleDarkMode()">ğŸŒ™ å¤œé—´æ¨¡å¼</button>
        <button class="btn" id="btn-add-textbox" onclick="addTextbox()">â• æ·»åŠ æ–‡æœ¬æ¡†</button>
        <div style="flex-grow:1"></div>
        <button class="btn" onclick="resetAll()">ğŸ”„ é‡ç½®ç”»å¸ƒ</button>
    </div>

    <div id="settings-panel">
        <h4>å…¨å±€è®¾ç½®</h4>
        <div class="control-group">
            <span class="control-title">åŸºç¡€è°ƒæ•´</span>
            <div class="slider-row">
                <span class="slider-label">æš—åº¦</span>
                <input type="range" id="rg-opacity" min="0" max="1" step="0.01" value="0.1" oninput="syncVal('opacity', this.value)">
                <input type="number" id="nb-opacity" step="0.01" value="0.1" oninput="syncVal('opacity', this.value)">
            </div>
            <div class="slider-row">
                <span class="slider-label">ç½‘æ ¼</span>
                <input type="range" id="rg-grid" min="20" max="100" step="1" value="40" oninput="syncVal('grid', this.value)">
                <input type="number" id="nb-grid" value="40" oninput="syncVal('grid', this.value)">
            </div>
        </div>
        <hr style="border:0; border-top:1px dashed #ddd; margin:10px 0;">
        <div id="quad-controls-container"></div>
    </div>

    <div id="canvas-area" ondrop="drop(event)" ondragover="allowDrop(event)">
        <div id="vignette-container">
            <div class="v-quadrant vq-tl"></div><div class="v-quadrant vq-tr"></div>
            <div class="v-quadrant vq-bl"></div><div class="v-quadrant vq-br"></div>
        </div>
        <div id="cl-tl" class="corner-label">è±¡é™è¯´æ˜</div>
        <div id="cl-tr" class="corner-label">è±¡é™è¯´æ˜</div>
        <div id="cl-bl" class="corner-label">è±¡é™è¯´æ˜</div>
        <div id="cl-br" class="corner-label">è±¡é™è¯´æ˜</div>
        <div id="axes-layer">
            <div class="axis-x"></div><div class="axis-y"></div>
            <div class="arrow arrow-up"></div><div class="arrow arrow-down"></div>
            <div class="arrow arrow-left"></div><div class="arrow arrow-right"></div>
        </div>
        <div id="label-top" class="axis-label" style="top:15px; left:50%; transform:translateX(-50%)" contenteditable="true">æ˜“ä¸Šæ‰‹(è‡ªè¡Œä¿®æ”¹)</div>
        <div id="label-bottom" class="axis-label" style="bottom:15px; left:50%; transform:translateX(-50%)" contenteditable="true">é«˜éš¾åº¦(è‡ªè¡Œä¿®æ”¹)</div>
        <div id="label-left" class="axis-label" style="top:50%; left:15px; transform:translateY(-50%)" contenteditable="true">é…é˜Ÿçµæ´»(è‡ªè¡Œä¿®æ”¹)</div>
        <div id="label-right" class="axis-label" style="top:50%; right:15px; transform:translateY(-50%)" contenteditable="true">é…é˜Ÿå›ºå®š(è‡ªè¡Œä¿®æ”¹)</div>
    </div>

    <div id="dock-container">
        <div id="dock-info">æ‹–åŠ¨è§’è‰²åˆ°ç™½æ¿ä¸Šï¼šå•å‡»ç½®é¡¶ï¼ŒåŒå‡»æ”¾å¤§</div>
        <div id="dock" ondrop="dropBackToDock(event)" ondragover="allowDrop(event)"></div>
    </div>

    <script>
        const iconList = ["çˆ±ä¸½å„¿.png", "æŠ•å½±ä½“Î».png", "Kå…ˆç”Ÿ.png", "æ³¡æ²«.png", "å¼ºå‡»æ‰‹.png", "é»˜æ±‰.png", "è„‰å†²æ˜Ÿ.png", "ç”µé­”.png", "ç›æ ¼å—.png", "çŠ¬é½¿.png", "è‰¾ç±³è‰äºš.png", "åŠ³æ‹‰.png", "åº·æ–¯å¦æ–¯.png", "åå†².png", "å®‰å¦®å¡”.png", "çµåª’.png", "é“¶æª.png", "å¹½çµå…‹æ˜Ÿ.png", "åº“ç€.png", "é›·å¨œå¡”.png", "ç»´å¥¥æ‹‰.png", "ç”µå…‰æ¸¸ä¾ .png", "ä¼Šä¸æ¢…å°”.png", "äº¨å¾·åˆ©.png", "ç‘›ç¾.png", "ç™½æ˜Ÿ.png", "ç‘›å.png", "å™¬è±¡è€….png", "ä¿¡æ ‡.png", "ç©ºä¸­å›šå¾’.png", "å¥¥å…¹æ›¼.png", "å¡”æ‹‰æ–¯å…‹.png", "å™©å…†.png", "å¤ªç©ºå°å§.png", "è°¢ä¸ƒ.png", "å¤œåˆƒ.png", "è¯ºæ‹‰.png", "é²éœ²éœ².png", "æ ¼è•¾èŒœ.png", "å¸Œå°”.png", "å”¤æµ·äºº.png", "è–‡ä¸å¸•é‡‘.png", "æ¦›æœ.png", "å¹»çœ¸.png", "å¼—æ´›ä¼¦ä¸.png", "ä¹Œæ‹‰å°¼å¨….png", "çŒ©çº¢çŸ³.png", "æ ¼ç³çˆ±å°”.png", "è¯ºç“¦å…‹.png", "æ¢…æŒæŸœ.png", "æ³¢å¹³æ–¯å°å§.png", "ç½ªå¾’.png", "ç´«ç½—å…°.png", "æ—èŠ³.png", "é“ƒ.png", "ä¼Šå¸Œä¸.png", "è¯ºè–‡å°”.png", "ç›ä¸½å®‰.png", "æ–¯æ–‡é¡¿.png", "è‰è´å¡.png", "å°æ´›ä¼¦ä½.png", "é›ªè‰.png", "ç½—æ³½.png", "è·é©¬å…ˆç”Ÿ.png", "è´æ‹‰æ–¯ç§‘.png", "é»‘ç‹®å­.png", "è±æ˜‚å†…å°”.png", "ç»´ç½—å¦®å¡.png", "å¾·æ´›ä¸½ä¸.png", "è€ƒå®˜.png", "å¡ç§‹è.png", "ç°çŒ.png", "ä¼Šå¾·.png", "çˆ±å¦®ä¸.png", "å¡å£¬.png", "éº¦å¨….png", "è±å¨œ.png", "åä¸‰å·.png", "æ‹‰å¡å°”.png", "ç½—æ£®è²å°”å¾·.png", "é¦™æ¥ .png", "å¸•æ–¯å¡.png", "æ²ƒå‰ç‰¹.png", "èµ¤ç‹.png", "ä¹”ä¼Š.png", "å¤œèº.png", "é›·è¯º.png", "å¨å»‰.png", "æ–¯è’‚å°”.png", "åˆå¤œ.png", "é‡‘å¡”äº”å·.png", "è´¾ç±³æ‹‰.png", "ç†æŸ¥å¾·æ›¼.png", "ç™½é‡‘.png", "å·¡é˜²å‘˜å¥¥é‡Œæ–¯.png", "å·¡é˜²å‘˜å¸Œå…°.png", "å·¡é˜²å‘˜åŠ æ›¼.png"]; 

        let draggedItem = null, maxZIndex = 2000;

        function initSettings() {
            const container = document.getElementById('quad-controls-container');
            const quads = [['tl','å·¦ä¸Š'],['tr','å³ä¸Š'],['bl','å·¦ä¸‹'],['br','å³ä¸‹']];
            quads.forEach(([id, name]) => {
                const group = document.createElement('div');
                group.className = 'control-group';
                group.innerHTML = `
                    <span class="control-title">${name}è±¡é™</span>
                    ${renderRow(id, 'size', 'å¤§å°', 0, 80, 35)}
                    ${renderRow(id, 'blur', 'æ¨¡ç³Š', 0, 50, 15)}
                    ${renderRow(id, 'fs', 'å­—å·', 1, 100, 64)} 
                    <div class="input-row"><input type="text" value="è±¡é™è¯´æ˜" oninput="updateText('${id}', this.value)"></div>
                `;
                container.appendChild(group);
            });
        }
        function renderRow(id, type, label, min, max, val) {
            const fullId = `${id}-${type}`;
            return `
                <div class="slider-row">
                    <span class="slider-label">${label}</span>
                    <input type="range" id="rg-${fullId}" min="${min}" max="${max}" value="${val}" oninput="syncVal('${fullId}', this.value)">
                    <input type="number" id="nb-${fullId}" value="${val}" oninput="syncVal('${fullId}', this.value)">
                </div>
            `;
        }

        function syncVal(key, val) {
            const rg = document.getElementById('rg-' + key);
            const nb = document.getElementById('nb-' + key);
            if (rg) rg.value = val;
            if (nb) nb.value = val;
            if (key === 'opacity') document.documentElement.style.setProperty('--global-opacity', val);
            else if (key === 'grid') document.documentElement.style.setProperty('--grid-size', val + 'px');
            else {
                const [q, type] = key.split('-');
                const unit = type === 'fs' ? 'px' : '%';
                document.documentElement.style.setProperty(`--${q}-${type}`, val + unit);
            }
        }

        function toggleDarkMode() {
            const isDark = document.body.classList.toggle('dark-mode');
            const btn = document.getElementById('btn-dark-mode');
            btn.innerHTML = isDark ? "â˜€ï¸ æ—¥é—´æ¨¡å¼" : "ğŸŒ™ å¤œé—´æ¨¡å¼";
            // ç§»é™¤äº† btn.classList.add/remove('active')
        }

        function toggleSettings() {
            const p = document.getElementById('settings-panel');
            const show = p.style.display !== 'block';
            p.style.display = show ? 'block' : 'none';
            document.getElementById('btn-toggle-settings').classList.toggle('active', show);
        }

        function addTextbox() {
            const div = document.createElement('div');
            div.className = 'floating-textbox';
            div.style.left = '391px'; div.style.top = '20px';
            div.innerHTML = `<div class="textbox-delete" onclick="this.parentElement.remove()">Ã—</div><div class="editable-content" contenteditable="true" data-placeholder="è¾“å…¥æ–‡æœ¬..."></div>`;
            document.getElementById('canvas-area').appendChild(div);
            makeDraggable(div);
        }

        function makeDraggable(el) {
            let offset = [0,0];
            el.onmousedown = (e) => {
                if(e.target.classList.contains('editable-content') || e.target.classList.contains('textbox-delete')) return;
                e.preventDefault();
                offset = [el.offsetLeft - e.clientX, el.offsetTop - e.clientY];
                el.style.zIndex = ++maxZIndex;
                document.onmousemove = (e) => {
                    el.style.left = (e.clientX + offset[0]) + 'px';
                    el.style.top = (e.clientY + offset[1]) + 'px';
                };
                document.onmouseup = () => { document.onmousemove = null; };
            };
        }

        function initIcons() {
            const dock = document.getElementById('dock');
            iconList.forEach(filename => {
                const div = document.createElement('div');
                div.className = 'draggable-item'; div.draggable = true; div.dataset.filename = filename;
                div.innerHTML = `<img src="./icons/${filename}"><div class="btn-delete">Ã—</div><div class="item-name">${filename.split('.')[0]}</div>`;
                div.ondragstart = (e) => { draggedItem = e.currentTarget; };
                div.onclick = () => { if(div.classList.contains('placed')) div.style.zIndex = ++maxZIndex; };
                div.ondblclick = () => { if(div.classList.contains('placed')) div.classList.toggle('zoomed'); };
                div.querySelector('.btn-delete').onclick = (e) => { e.stopPropagation(); removeToDock(div); };
                dock.appendChild(div);
            });
        }

        function drop(ev) {
            ev.preventDefault(); if (!draggedItem) return;
            const canvas = document.getElementById('canvas-area'), rect = canvas.getBoundingClientRect();
            if (!draggedItem.classList.contains('placed')) { draggedItem.classList.add('placed'); canvas.appendChild(draggedItem); }
            draggedItem.style.zIndex = ++maxZIndex;
            draggedItem.style.left = (ev.clientX - rect.left) + 'px'; 
            draggedItem.style.top = (ev.clientY - rect.top) + 'px';
            draggedItem = null;
        }

        function removeToDock(el) {
            el.classList.remove('placed', 'zoomed'); el.style.left = ''; el.style.top = ''; 
            const dock = document.getElementById('dock'), items = Array.from(dock.children); items.push(el);
            items.sort((a, b) => iconList.indexOf(a.dataset.filename) - iconList.indexOf(b.dataset.filename));
            items.forEach(item => dock.appendChild(item));
        }

        function toggleAxes() {
            const l = document.getElementById('axes-layer');
            const show = l.style.display !== 'block';
            l.style.display = show ? 'block' : 'none';
            const btn = document.getElementById('btn-toggle-axes');
            btn.innerText = show ? "æ˜¾ç¤ºåæ ‡è½´ (å¼€)" : "æ˜¾ç¤ºåæ ‡è½´ (å…³)";
            // ç§»é™¤äº† btn.classList.toggle('active', show)
        }

        function resetAll() { if(confirm('é‡ç½®ç”»å¸ƒï¼Ÿ')) location.reload(); }
        function updateText(pos, val) { document.getElementById(`cl-${pos}`).innerText = val; }
        function allowDrop(e) { e.preventDefault(); }
        function dropBackToDock(e) { e.preventDefault(); if(draggedItem) removeToDock(draggedItem); draggedItem = null; }

        window.onload = () => { initSettings(); initIcons(); };
    </script>
</body>
</html>
